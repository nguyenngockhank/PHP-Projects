<?phpfunction cmp($a, $b) {    if ($a['order'] == $b['order']) {        return 0;    }    return ($a['order'] < $b['order']) ? -1 : 1;}class Category_Model extends CI_Model {    const TABLE = 'category';    private $categories = array();    private function _select() {        if ($GLOBALS['language'] === 'en') {            return 'id, name, order, parent_id';        }        return 'id, viname AS name, order, parent_id';    }    public function __construct() {        parent::__construct();        $all = $this->db->select($this->_select())->order_by('parent_id')->get(Category_Model::TABLE)->result_array();        $this->process($all);    }    private function process(&$all) {        foreach ($all as $cat) { // phân loại root và con            if ($cat['parent_id'] == 0) { // root                $this->categories[$cat['id']] = $cat;            } else {                $this->categories[$cat['parent_id']]['child'][$cat['id']] = $cat;            }        }    }    private function _get_by_id($id) {        if (isset($this->categories[$id])) {            return $this->categories[$id];        }        foreach ($this->categories as &$parent) {            if (isset($parent['child'][$id])) {                return $parent['child'][$id];            }        }    }    public function &getAll($sort = true) {        if ($sort)            usort($this->categories, "cmp");        return $this->categories;    }    public function getById($id) {        return $this->_get_by_id($id);    }}?>